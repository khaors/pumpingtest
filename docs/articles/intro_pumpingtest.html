<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>pumpingtest: Analysis and Evaluation of Pumping Test Data in R • pumpingtest</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="pumpingtest: Analysis and Evaluation of Pumping Test Data in R">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pumpingtest</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro_pumpingtest.html">pumpingtest: Analysis and Evaluation of Pumping Test Data in R</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/khaors/pumpingtest">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>pumpingtest: Analysis and Evaluation of Pumping Test Data in R</h1>
                        <h4 class="author">Oscar Garcia-Cabrejo</h4>
            
            <h4 class="date">2019-06-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/khaors/pumpingtest/blob/master/vignettes/intro_pumpingtest.Rmd"><code>vignettes/intro_pumpingtest.Rmd</code></a></small>
      <div class="hidden name"><code>intro_pumpingtest.Rmd</code></div>

    </div>

    
    
<p>This document defines the basic concepts, governing equations, numerical procedures, organization of functions and show some examples of analysis and evaluation of pumping test data using the package PumpingTest.</p>
<div id="pumping-test" class="section level2">
<h2 class="hasAnchor">
<a href="#pumping-test" class="anchor"></a>Pumping Test</h2>
<p>A pumping test is a field experiment in which water is extracted from well at a controlled rate and the change in water level (drawdown) is measured in one or more observation wells and optionally in the pumped well. This information from pumping tests are used to estimate the hydraulic properties of aquifers (Transmisivity and Storage coefficient), evaluate the well performance and identify aquifer boundaries. Aquifer test and aquifer performance test (APT) are other terms to designate a pumping test.</p>
<p>The analysis and evaluation of pumping test data are necessary to propose solutions to specific groundwater problems. In the analysis stage, the measurements of the response of the aquifer system (drawdown) are used to understand the structure and functioning of the flow system. Specifically, the definition of the aquifer type, identification of the sources and sinks, and the estimation of the hydraulic parameters of the aquifer unit are the main results in this stage. The conventional estimation of the hydraulic parameters is based on the use of graphical methods and tables, but this procedure can be approached as a nonlinear regression problem if analytical expressions of the response of the aquifer to the water extraction are available.</p>
<p>In the evaluation stage, the analytical model identified as the most representative of the aquifer conditions along with the hydraulic parameters (Transmissivity and Storage coefficient) are used in the prediction of the drawdown in space and/or time. These predictions are critical to determine the effect of water extraction on the vecinity of the pumping well under real or hypothetical conditions.</p>
</div>
<div id="governing-equations" class="section level2">
<h2 class="hasAnchor">
<a href="#governing-equations" class="anchor"></a>Governing Equations</h2>
<p>The general description of the flow of water in porous media is given by the continuity equation in cylindrical coordinates: <span class="math display">\[
\frac{1}{r}\frac{\partial}{\partial r}\left( r\frac{\partial s}{\partial r} \right) = \frac{S}{T}\frac{\partial s}{\partial t}
\]</span></p>
<p>where <span class="math inline">\(s\)</span> is the drawdown, <span class="math inline">\(r\)</span> is the distance between the pumping and observation well, <span class="math inline">\(t\)</span> is the time, <span class="math inline">\(Q\)</span> is the pumping rate, <span class="math inline">\(q\)</span> is a term to include all the sources and sinks, <span class="math inline">\(S\)</span> is the storage coefficient and <span class="math inline">\(T\)</span> is the transmissivity.</p>
<p>The general solution of the previous equation can be expressed as: <span class="math display">\[
s(r,t) = \frac{Q}{4 \pi T} W(\boldsymbol{\theta})
\]</span> where <span class="math inline">\(W(\boldsymbol{\theta})\)</span> is the so called well function and <span class="math inline">\(\boldsymbol{\theta}\)</span> is a vector of parameters (including Transmissivity, Storage coefficient and others). The importance of the well function lies in that this describes the nondimensional change of the drawdown with respect to time, and therefore the previous equation implies that the drawdown for a specific well can be obtained via rescaling of the corresponding well function.</p>
<p>There are few cases where analytical expression of the well function <span class="math inline">\(W(\boldsymbol{\theta})\)</span> can be obtained. EXAMPLES?. This implies that for the majority of cases this well function is obtained using numerical methods. The preferred numerical method used to solve the original continuity equation in cylindrical coordinates is the Laplace Transform <span class="citation">(Doetsch 1974)</span>. The basic idea of this transform is to convert a partial differential equation into an ordinary differential equation by removing the time variable. Once the ordinary differential equation is solved, then the inverse Laplace Transform is applied to recover the solution in the original space. The conventional approach to recover this solution is based on visual inspection of a table of inverse transforms of a set of functions but in most cases, it is not possible to obtain a close analytical expression for the solution of the ODE, and that is why the numerical approach is used. The inverse Laplace Transform is calculated using the Stehfest algorithm <span class="citation">Stehfest (1970)</span> which has proven to be stable for the calculations required for the estimation of the pumping tests.</p>
</div>
<div id="package-organization" class="section level2">
<h2 class="hasAnchor">
<a href="#package-organization" class="anchor"></a>Package Organization</h2>
<p>The PumpingTest package is based on the definition of a S3 class called <em>pumping_test</em> that is used to store the following information:</p>
<ul>
<li>Well ID</li>
<li>Pumping rate <span class="math inline">\(Q\)</span>
</li>
<li>Distance to pumping well <span class="math inline">\(r\)</span>
</li>
<li>Numeric vectors with time and drawdown values <span class="math inline">\((t_{i},s_{i}),i=1,\ldots,n\)</span>
</li>
</ul>
<p>There are basic functions associated with this S3 class including:</p>
<ul>
<li>print: shows the information of time and drawdown on the screen.</li>
<li>summary: prints a statistical summary of the drawdown data.</li>
<li>plot: create different kinds of plots including diagnostic, estimation, model diagnostic, and a</li>
<li>fit: estimate the hydraulic parameters using nonlinear regression with the information from the pumping test and an identified aquifer model.</li>
<li>fit.optimization: estimate the hydraulic parameters using one of several optimization tecniques show in the following table</li>
<li>fit.sampling: estimate the hydraulic parameters using bayesian methods</li>
<li>evaluate: calculate the drawdown in space and time from a given set of hydraulic parameters.</li>
<li>confint: estimate the confidence intervals of the hydraulic parameters using different methods.</li>
</ul>
<p>The <em>fit.optimization</em> function can be used with the following optimization methods:</p>
<table class="table">
<thead><tr class="header">
<th>Optimization method</th>
<th>Package</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Nonlinear Regression</td>
<td>minpack.lm</td>
</tr>
<tr class="even">
<td>Quasi-Newton method</td>
<td>optim</td>
</tr>
<tr class="odd">
<td>Simulated Annealing</td>
<td>GenSA</td>
</tr>
<tr class="even">
<td>Genetic Algorithms</td>
<td>GA</td>
</tr>
<tr class="odd">
<td>Particle Swarm Optimization</td>
<td>pso</td>
</tr>
<tr class="even">
<td>Differential Evolution</td>
<td>DEoptim</td>
</tr>
</tbody>
</table>
<p>The <em>fit.samping</em> function can be used with the following MCMC methods:</p>
<ul>
<li>Adaptative MCMC</li>
<li>t-walk <span class="citation">(Christen and Fox 2010)</span>
</li>
</ul>
<p>This package includes different types of plots. The diagnostic plot created using the <em>plot</em> function is of one of the most important tools for the analysis of pumping test data, and it includes the plot of the drawdown in function of time and the plot of the derivative of drawdown with respect to the log of time in the same figure. From the variation showed by the derivative it is possible to identify the different flow regime present during the test and therefore the most likely models that explains the observed variations in drawdown <span class="citation">(Duong 1989)</span>. In the estimation plot, the drawdown and its derivative with respest to time and their corresponding curves defined with the fitted parameters are shown in the sampe figure. This is an important tool to assess the fit provided by the estimaed parameters, and to identify the measurements that do not follow the fitted model. If the hydrogeologist determines that the obtained fit does not represent the observed data, then the problematic measurements can be removed and the estimation starts again.</p>
<p>The <em>pumping_test</em> package includes the following analytical solutions that can be used in different types of geological conditions. The base names of the solutions included in this package are the following:</p>
<table class="table">
<thead><tr class="header">
<th>Solution Name</th>
<th>Conditions</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>theis</td>
<td>Confined aquifer</td>
</tr>
<tr class="even">
<td>cooper_jacob</td>
<td>Confined aquifer</td>
</tr>
<tr class="odd">
<td>hantush_jacob</td>
<td>Confined Leaky aquifer</td>
</tr>
<tr class="even">
<td>boulton</td>
<td>Phreatic aquifer</td>
</tr>
<tr class="odd">
<td>cooper</td>
<td>Slug test</td>
</tr>
<tr class="even">
<td>agarwal</td>
<td>Recovery test</td>
</tr>
<tr class="odd">
<td>agarwal</td>
<td>Wellbore storage</td>
</tr>
<tr class="even">
<td>general_radial_flow</td>
<td>Fractured aquifer</td>
</tr>
<tr class="odd">
<td>neuzil</td>
<td>Slug test (Pulse)</td>
</tr>
<tr class="even">
<td>papadopoulous_cooper</td>
<td>Confined aquifer, large diameter well</td>
</tr>
<tr class="odd">
<td>warren_root</td>
<td>double porosity</td>
</tr>
<tr class="even">
<td>gringarten</td>
<td>Single fracture</td>
</tr>
</tbody>
</table>
<p>In this package, cach analytical solution is implemented using 6 different functions:</p>
<ul>
<li>
<strong>well_function</strong>: calculates the well function of the specific model calling the corresponding fuction that calculates the solution in the Laplace domain and the stehfest inversion.</li>
<li>
<strong>solution_initial</strong>: This is the self-starter function for the nonlinear regression function and calculates the initial value of the parameters to fit a specific model.<br>
</li>
<li>
<strong>calculate_parameters</strong>: calculates the hydraulic parameters from the values of the fitting parameters</li>
<li>
<strong>solution</strong>: calculates the drawdown</li>
<li>
<strong>solution_dlogt</strong>: calculates the derivative of the drawdown with respect to the derivative of the logarithm of time.</li>
<li>
<strong>WF_LT</strong>: calculates the well function (WF) in the Laplace domain</li>
</ul>
<p>where the name of the analytical solution is added as prefix:</p>
<ul>
<li>theis_well_function, theis_solution_initial</li>
<li>boulton_well_function, boulton_WF_LT, boulton_calculate_parameters.</li>
</ul>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<div id="pumping-test-in-a-confined-aquifer" class="section level3">
<h3 class="hasAnchor">
<a href="#pumping-test-in-a-confined-aquifer" class="anchor"></a>Pumping Test in a Confined Aquifer</h3>
<p>The drawdown data from the pumping test in a confined aquifer is save in the data.frame <em>theis</em> included in the package. This data.frame is loaded using:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(theis)</a></code></pre></div>
<p>This data.frame is composed of two variables:</p>
<ul>
<li>t: Vector with the values of time when measurements were recorded</li>
<li>s: Vector with the values of drawdown</li>
</ul>
<p>This drawdown was caused by a well withdrawing water at a pumping rate of<br><span class="math inline">\(Q=1.2\;\; l/s\)</span> which is equivalent to <span class="math inline">\(Q=1.388 \times 10^{-2}\;\;m^{3}/s\)</span>, and located at <span class="math inline">\(r=250\;\;m\)</span> from the observation well. The pumping_test object is defined using:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">ptest.theis &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pumping_test.html">pumping_test</a></span>(<span class="st">"Well 1"</span>, <span class="dt">Q =</span> <span class="fl">1.3888e-2</span>, <span class="dt">r =</span> <span class="dv">250</span>, <span class="dt">t =</span> theis<span class="op">$</span>t, <span class="dt">s =</span> theis<span class="op">$</span>s)</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">p1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(ptest.theis)</a></code></pre></div>
<pre><code>## Joining, by = c("t", "s", "variable")</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(p1)</a></code></pre></div>
<p><img src="intro_pumpingtest_files/figure-html/plot_theis-1.png" width="576" style="display: block; margin: auto;"></p>
<div id="diagnostic-plots" class="section level4">
<h4 class="hasAnchor">
<a href="#diagnostic-plots" class="anchor"></a>Diagnostic Plots</h4>
<p>The diagnostic plot is the default option in the <em>plot</em> function, in which the derivative of the drawdown with respect to the logarithm of time is calculated via central differences. The drawdown derivative is very sensitive to the noise present in the drawdown measurements and therefore it is advisable to create the diagnostic plot using different derivative types. In this case, four types of derivatives are used in the diagnostic plots:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(gridExtra)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">p.central &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(ptest.theis, <span class="dt">dmethod =</span> <span class="st">"central"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">legend.position=</span><span class="st">"bottom"</span>)</a></code></pre></div>
<pre><code>## Joining, by = c("t", "s", "variable")</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">p.horner &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(ptest.theis, <span class="dt">dmethod =</span> <span class="st">"horner"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">legend.position=</span><span class="st">"bottom"</span>)</a></code></pre></div>
<pre><code>## Joining, by = c("t", "s", "variable")</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">p.bourdet &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(ptest.theis, <span class="dt">dmethod =</span> <span class="st">"bourdet"</span>, <span class="dt">d =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">legend.position=</span><span class="st">"bottom"</span>)</a></code></pre></div>
<pre><code>## Joining, by = c("t", "s", "variable")</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">p.spline &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(ptest.theis, <span class="dt">dmethod =</span> <span class="st">"spline"</span>, <span class="dt">d =</span> <span class="dv">20</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">legend.position=</span><span class="st">"bottom"</span>)</a></code></pre></div>
<pre><code>## Joining, by = c("t", "s", "variable")</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">p.diagnostic &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/gridExtra/topics/arrangeGrob">grid.arrange</a></span>(p.central, p.horner, p.bourdet, p.spline, </a>
<a class="sourceLine" id="cb14-2" data-line-number="2">                             <span class="dt">nrow =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="intro_pumpingtest_files/figure-html/theis_diagnostic_plot1-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(p.diagnostic)</a></code></pre></div>
<pre><code>## TableGrob (2 x 2) "arrange": 4 grobs
##   z     cells    name           grob
## 1 1 (1-1,1-1) arrange gtable[layout]
## 2 2 (1-1,2-2) arrange gtable[layout]
## 3 3 (2-2,1-1) arrange gtable[layout]
## 4 4 (2-2,2-2) arrange gtable[layout]</code></pre>
<p>The drawdown data appears as black points while the derivative of drawdown is represented as red symbols. In all cases, the derivative shows an increasing behavior up to <span class="math inline">\(500 \; s\)</span> and then it seems to reach a plateau. However this is not very clear due to the high dispersion showed by the derivative estimates in the case of central finite differences, Horne’s and Bourdet’s approaches. The only stable derivative is the one calculated using the spline approach, specially when <span class="math inline">\(20-40\)</span> samples are used in the interpolation step <span class="citation">(Renard, Glenz, and Mejias 2008)</span>.</p>
<p>From the previous figures, it is clear that the derivative of the drawdown with respect to the logarithm of time shows an increasing behavior up to <span class="math inline">\(t=500\;\;s\)</span> and then it stabilizes with a value of <span class="math inline">\(0.8\)</span> approximately. This behaviour is typical of a confined aquifer and therefore the Theis solution describes the variation displayed by the drawdown. Now that we know the model to be used to fit the data, let’s estimate the hydraulic parameters.</p>
</div>
<div id="parameter-estimation" class="section level4">
<h4 class="hasAnchor">
<a href="#parameter-estimation" class="anchor"></a>Parameter Estimation</h4>
<p>The function <em>fit</em> is used to estimate the parameters of the model. In the <em>PumpingTest</em> package, most of the models included are parametrized in terms of nuance parameters instead of the hydraulic properties of the aquifer. For the Theis model, the parameters are the slope <span class="math inline">\(a\)</span> and the intercept <span class="math inline">\(t_{0}\)</span> of the straight line fitted for the late measurements of drawdown where the logarithm of time is taken as the independent variable. The estimation of these parameters <span class="math inline">\(a\)</span> and <span class="math inline">\(t_{0}\)</span> is obtained via nonlinear regression using the <em>fit</em> command:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">ptest.fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fit.html">fit</a></span>(ptest.theis, <span class="st">"theis"</span>)</a></code></pre></div>
<p>The output of this command is a list that contains three variables:</p>
<ul>
<li>
<strong>parameters</strong>: a list with the values of the nuance parameters <span class="math inline">\(a\)</span> and <span class="math inline">\(t_{0}\)</span>
</li>
<li>
<strong>hydraulic_parameters</strong>: a list with the values of transmissivity, storage coefficient and radius of influence</li>
<li>
<strong>nlsfit</strong>: an object of the class <em>nls</em> that contains all the information related to the nonlinear regression procedure used in the estimation of the nuance parameters.</li>
</ul>
<p>Let’s take a look at the values of the nuance parameters accessing the parameters variable:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">ptest.fit<span class="op">$</span>parameters</a></code></pre></div>
<pre><code>## $a
## [1] 1.78566
## 
## $t0
## [1] 413.0369</code></pre>
<p>This shows that the value of <span class="math inline">\(a=\)</span> 1.7856604 and <span class="math inline">\(t_{0}=\)</span> 413.0369046. From these values the hydraulic parameters specific for this model are internally calculated by the <em>fit</em> function using the <em>theis_calculate_parameters</em> function and the results are:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">ptest.fit<span class="op">$</span>hydraulic_parameters</a></code></pre></div>
<pre><code>## $Tr
## [1] 0.001425104
## 
## $Ss
## [1] 2.115116e-05
## 
## $radius_influence
## [1] 2843.458</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">Tr &lt;-<span class="st"> </span>ptest.fit<span class="op">$</span>hydraulic_parameters<span class="op">$</span>Tr</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">Ss &lt;-<span class="st"> </span>ptest.fit<span class="op">$</span>hydraulic_parameters<span class="op">$</span>Ss</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">Ri &lt;-<span class="st"> </span>ptest.fit<span class="op">$</span>hydraulic_parameters<span class="op">$</span>radius_influence</a></code></pre></div>
<p>which means that the transmissivity is equal to 1.43e-03 m2/s, the storage coefficient is 2.12e-05, and the radius of influence is equal to 2.84e+03 m or 2.84e+00 km.</p>
<p>Using the values of the hydraulic parameters, now it is possible to create the estimation plot. This requires the assignment of the results of the fitting procedure to the <em>pumping_test</em> object which is done using the following auxiliary functions:</p>
<ul>
<li>
<em>hydraulic.parameters</em>: assigns the hydraulic_parameters variable to the <em>pumping_test</em> object</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">hydraulic.parameters</span>(ptest.theis) &lt;-<span class="st"> </span>ptest.fit<span class="op">$</span>hydraulic_parameters</a></code></pre></div>
<ul>
<li>
<em>fit.parameters</em>: assigns the nuance parameters to the <em>pumping_test</em> object</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw">fit.parameters</span>(ptest.theis) &lt;-<span class="st"> </span>ptest.fit<span class="op">$</span>parameters</a></code></pre></div>
<ul>
<li>
<em>model</em>: assigns the model to the <em>pumping_test</em> object</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw">model</span>(ptest.theis) &lt;-<span class="st"> "theis"</span></a></code></pre></div>
<ul>
<li>
<em>estimated</em>: specifies that the <em>pumping_test</em> object has the estimation information</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw">estimated</span>(ptest.theis) &lt;-<span class="st"> </span><span class="ot">TRUE</span></a></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">p.estimation &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(ptest.theis, <span class="dt">type =</span> <span class="st">"estimation"</span>, <span class="dt">dmethod =</span> <span class="st">"spline"</span>, </a>
<a class="sourceLine" id="cb27-2" data-line-number="2">                     <span class="dt">d =</span> <span class="dv">30</span>) </a></code></pre></div>
<pre><code>## Joining, by = c("t", "s", "variable")</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(p.estimation)</a></code></pre></div>
<p><img src="intro_pumpingtest_files/figure-html/theis_estimation-1.png" width="576" style="display: block; margin: auto;"></p>
<p>The visual inspection of the previous figure shows that there is a good fit between the model and the drawdown measurements and even the derivative. These are good news but it is critical to be sure that the fitted model satisfy the assumptions behind a nonlinear regression model. If these conditions are not checked then it is not possible to be sure that the model is appropiate and therefore the predictions based upon these hydraulic parameters are correct. The tools to check the fitted model are presented in the next section.</p>
</div>
</div>
<div id="model-diagnostic" class="section level3">
<h3 class="hasAnchor">
<a href="#model-diagnostic" class="anchor"></a>Model Diagnostic</h3>
<p>The model fitted with nonlinear regression should satisfy the following conditions:</p>
<ul>
<li>correct mean function</li>
<li>mutually independent residuals (0 mean and uncorrelated)</li>
<li>residuals with variance homogeneity (homoscedasticity)</li>
<li>normally distributed residuals</li>
</ul>
<p>These assumptions can be checked informally using specialized plots which can be created using the plot function:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">p.mod.diag &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(ptest.theis, <span class="dt">type =</span> <span class="st">'model.diagnostic'</span>)</a></code></pre></div>
<pre><code>## Joining, by = c("t", "s", "variable")</code></pre>
<pre><code>## `geom_smooth()` using method = 'loess' and formula 'y ~ x'
## `geom_smooth()` using method = 'loess' and formula 'y ~ x'</code></pre>
<p><img src="intro_pumpingtest_files/figure-html/theis_residuals-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(p.mod.diag)</a></code></pre></div>
<pre><code>## TableGrob (2 x 2) "arrange": 4 grobs
##   z     cells    name           grob
## 1 1 (1-1,1-1) arrange gtable[layout]
## 2 2 (1-1,2-2) arrange gtable[layout]
## 3 3 (2-2,1-1) arrange gtable[layout]
## 4 4 (2-2,2-2) arrange gtable[layout]</code></pre>
<p>In the previous figure, each condition is checked by each plot. The first assumption of the fitted model can be checked using the a scatterplot of the measured and calculated drawdown (upper left plot). In this case the reproduction of the measured values is good as seen by the value of the correlation coefficient and the fact that all values lie close to the diagonal red line. The second assumption can be checked using the plot located on the upper right part of the figure. This shows a scatterplot between the calculated drawdown and the residuals, which shows that there are no relationship between them (no trend in the scatterplot) and the residual values lie around 0 (zero mean residuals). The local mean of the residua (red line) oscillates around 0. The variance of the residuals can be checked indirectly using the absolute residuals (lower left), which shows that there are no large variations. The fourth condition can be checked with a normal quantile plot as seen in the lower right part of the figure. There are deviations from the red line only at the tails of the residual distribution. From the previous figure, it is clear the all conditions of the nonlinear regression model are met and therefore the hydraulic parameters can be used with confidence.</p>
</div>
<div id="uncertainty-quantification" class="section level3">
<h3 class="hasAnchor">
<a href="#uncertainty-quantification" class="anchor"></a>Uncertainty Quantification</h3>
<p>In this last step, the uncertainty in the estimates of the hydraulic parameters is quantified using a simple bootstrapp approach. This method is based on the defining a new drawdown curve using a new set of residuals obtained form the resampling with replacement of the original residuals. Then the hydraulic parameters are estimated for all the generated curves and with the results a probability density function for each parameter can be defined. Estimates of confidence intervals can be derived <em>nonparametrically</em> from these probability density functions.</p>
<p>The confidence intervals of the hydraulic parameters can be estimated using the <strong>confint</strong> function:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">ptest.theis.ci &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/confint">confint</a></span>(ptest.theis, <span class="dt">level =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), </a>
<a class="sourceLine" id="cb35-2" data-line-number="2">                          <span class="dt">method =</span> <span class="st">"bootstrap"</span>, <span class="dt">d =</span> <span class="dv">20</span>, </a>
<a class="sourceLine" id="cb35-3" data-line-number="3">                          <span class="dt">neval =</span> <span class="dv">100</span>, <span class="dt">seed =</span> <span class="dv">12346</span>)</a></code></pre></div>
<p>The results of the estimation are stored in the variable ptest.test.ci, and these results must be assigned to the ptest.theis object:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="kw">hydraulic.parameters</span>(ptest.theis) &lt;-<span class="st"> </span>ptest.theis.ci<span class="op">$</span>hydraulic.parameters</a>
<a class="sourceLine" id="cb36-2" data-line-number="2"><span class="kw">hydraulic.parameter.names</span>(ptest.theis) &lt;-<span class="st"> </span>ptest.theis.ci<span class="op">$</span>hydraulic.parameters.names</a>
<a class="sourceLine" id="cb36-3" data-line-number="3"><span class="kw">estimated</span>(ptest.theis) &lt;-<span class="st"> </span><span class="ot">TRUE</span></a></code></pre></div>
<p>The confidence intervals of the hydraulic parameters for the pumping test applied in a confined aquifer are shown in the following table.</p>
<table class="table">
<caption>Theis solution. Confindence intervals of the Hydraulic Parameters</caption>
<thead><tr class="header">
<th></th>
<th align="right">2.5%</th>
<th align="right">97.5%</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Tr</td>
<td align="right">0.0013984</td>
<td align="right">1.44570e-03</td>
</tr>
<tr class="even">
<td>Ss</td>
<td align="right">0.0000204</td>
<td align="right">2.18000e-05</td>
</tr>
<tr class="odd">
<td>radius_influence</td>
<td align="right">2779.4235685</td>
<td align="right">2.91425e+03</td>
</tr>
</tbody>
</table>
<p>The uncertainty plot can be created using the <strong>plot</strong> function:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">p.uncert &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(ptest.theis, <span class="dt">type =</span> <span class="st">"uncertainty"</span>)</a></code></pre></div>
<pre><code>## Joining, by = c("t", "s", "variable")</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(p.uncert)</a></code></pre></div>
<p><img src="intro_pumpingtest_files/figure-html/theis_boot4-1.png" width="768" style="display: block; margin: auto;"></p>
<p>The previous figure shows along the diagonals the probability density function of the hydraulic parameters estimated using 100 boostrap realizations. The probability distributions of these parameters are unimodal and nearly symmetric in all cases. On the off-diagonals, the scatterplots of the hydraulic parameters are shown where it is clear that the transmissivity and storage coefficient are not independent of each other, and this implies that in reality there is one single parameter defining the model. This parameter is called hydraulic diffusivity which is defined as the ratio of the transmissivity to the storage coefficient.</p>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-Christen_2010">
<p>Christen, J. Andr’es, and Colin Fox. 2010. “A General Purpose Sampling Algorithm for Continuous Distributions (the T-Walk).” <em>Bayesian Analysis</em> 5 (2). Institute of Mathematical Statistics: 263–81. <a href="https://doi.org/10.1214/10-ba603">https://doi.org/10.1214/10-ba603</a>.</p>
</div>
<div id="ref-doetsch1974">
<p>Doetsch, G. 1974. <em>Introduction to the Theory and Application of the Laplace Transformation</em>. Springer-Verlag. <a href="https://books.google.com.co/books?id=AreGQgAACAAJ">https://books.google.com.co/books?id=AreGQgAACAAJ</a>.</p>
</div>
<div id="ref-Duong_1989">
<p>Duong, Anh N. 1989. “A New Set of Type Curves for Well-Test Interpretation with the Pressure/Pressure-Derivative Ratio.” <em>SPE Formation Evaluation</em> 4 (02). Society of Petroleum Engineers (SPE): 264–72. <a href="https://doi.org/10.2118/16812-pa">https://doi.org/10.2118/16812-pa</a>.</p>
</div>
<div id="ref-Renard_2008">
<p>Renard, Philippe, Damian Glenz, and Miguel Mejias. 2008. “Understanding Diagnostic Plots for Well-Test Interpretation.” <em>Hydrogeology Journal</em> 17 (3). Springer Nature: 589–600. <a href="https://doi.org/10.1007/s10040-008-0392-0">https://doi.org/10.1007/s10040-008-0392-0</a>.</p>
</div>
<div id="ref-Stehfest_1970">
<p>Stehfest, Harald. 1970. “Algorithm 368: Numerical Inversion of Laplace Transforms [D5].” <em>Communications of the ACM</em> 13 (1). Association for Computing Machinery (ACM): 47–49. <a href="https://doi.org/10.1145/361953.361969">https://doi.org/10.1145/361953.361969</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#pumping-test">Pumping Test</a></li>
      <li><a href="#governing-equations">Governing Equations</a></li>
      <li><a href="#package-organization">Package Organization</a></li>
      <li><a href="#example">Example</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Oscar Garcia-Cabrejo.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
